<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catered Savings - Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="login-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .admin-logo {
            margin-bottom: 15px;
        }
        .header-actions {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .logout-btn:hover {
            background: #e55a2b !important;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="login-container" class="login-container">
        <div class="login-form">
            <div class="login-header">
                <div class="admin-logo">
                    <img src="/logo.svg" alt="Catered Savers Logo" width="200" height="80" style="margin: 0; padding: 0;">
                </div>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" name="password" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
                <div id="login-error" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard (hidden until login) -->
    <div id="admin-container" class="admin-container" style="display: none;">
        <!-- Sidebar Navigation -->
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <div class="admin-logo">
                    <img src="/logo.svg" alt="Catered Savers Logo" width="200" height="80" style="margin: 0; padding: 0;">
                </div>
                <div class="header-actions">
                    <button id="logout-btn" class="logout-btn" title="Logout" style="background: #ff6b35; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
            
            <ul class="sidebar-nav">
                <li class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-tab="products">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </li>
                <li class="nav-item" data-tab="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </li>
                <li class="nav-item" data-tab="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </li>
                <li class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <a href="/" class="view-site-btn">
                    <i class="fas fa-external-link-alt"></i>
                    View Site
                </a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="admin-main">
            <!-- Top Header -->
            <header class="admin-header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard</h1>
                    <p id="page-description">Overview of your Catered Savings business</p>
                </div>
                <div class="header-right">
                    <div class="admin-user">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=667eea&color=fff" alt="Admin" class="admin-avatar">
                        <span>Admin</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-users">0</h3>
                            <p>Total Subscribers</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="active-products">0</h3>
                            <p>Active Products</p>
                        </div>
                    </div>
                    
                    <div class="stat-card coming-soon">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Coming Soon</h3>
                            <p>Monthly Revenue</p>
                        </div>
                    </div>
                    
                    <div class="stat-card coming-soon">
                        <div class="stat-icon">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Coming Soon</h3>
                            <p>Total Clicks</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Products Management Tab -->
            <div id="products" class="tab-content">
                <div class="tab-header">
                    <h2>Products Management</h2>
                    <div class="product-actions">
                        <button class="btn btn-primary" id="upload-csv-btn">
                            <i class="fas fa-upload"></i> Upload CSV
                        </button>
                        <button class="btn btn-danger" id="clear-all-products-btn">
                            <i class="fas fa-trash"></i> Clear All Products
                        </button>
                    </div>
                </div>

                <!-- CSV Upload Section -->
                <div class="csv-upload-section">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-content">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <h3>Upload Products CSV</h3>
                            <p>Drag and drop your CSV file here, or click to browse</p>
                            <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                            <button class="btn btn-outline" id="browse-files-btn">Browse Files</button>
                        </div>
                    </div>
                    
                    <div class="csv-preview" id="csv-preview" style="display: none;">
                        <h4>CSV Preview (First 3 rows)</h4>
                        <div class="preview-table-container">
                            <table class="preview-table" id="preview-table">
                                <!-- Preview rows will be inserted here -->
                            </table>
                        </div>
                        <div class="preview-actions">
                            <button class="btn btn-success" id="process-csv-btn">
                                <i class="fas fa-check"></i> Process Data
                            </button>
                            <button class="btn btn-secondary" id="cancel-upload-btn">Cancel</button>
                        </div>
                    </div>
                    
                    <div class="upload-results" id="upload-results" style="display: none;">
                        <h4>Upload Results</h4>
                        <div class="results-summary" id="results-summary">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="products-table-container">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Original Price</th>
                                <th>Discount</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Clicks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <tr>
                                <td colspan="9" class="empty-state">
                                    <div class="empty-content">
                                        <i class="fas fa-box"></i>
                                        <p>No products found</p>
                                        <p>Products are loading from the server...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Affiliate ID Edit Modal -->
                <div id="affiliate-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Edit Affiliate ID</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="affiliate-form">
                                <input type="hidden" id="edit-product-id">
                                <div class="form-group">
                                    <label for="edit-affiliate-id">Affiliate ID:</label>
                                    <input type="text" id="edit-affiliate-id" placeholder="Enter your affiliate ID">
                                    <small>Example: For Amazon, enter your Associates tag (e.g., "cateredsavers-20")</small>
                                </div>
                                <div class="form-group">
                                    <label for="edit-tracking-id">Tracking ID (Optional):</label>
                                    <input type="text" id="edit-tracking-id" placeholder="Enter tracking ID if needed">
                                    <small>Additional tracking parameter for some affiliate programs</small>
                                </div>
                                <div class="form-group">
                                    <label>Current Affiliate URL:</label>
                                    <div id="current-affiliate-url" class="url-display"></div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" id="cancel-affiliate-btn">Cancel</button>
                            <button type="button" class="btn btn-primary" id="save-affiliate-btn">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Signup Trends</h3>
                        <div id="signup-trends" class="chart-placeholder">
                            <i class="fas fa-chart-line"></i>
                            <p>Loading trends...</p>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>Category Distribution</h3>
                        <div id="category-distribution" class="chart-placeholder">
                            <i class="fas fa-chart-pie"></i>
                            <p>Loading distribution...</p>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>Click Performance</h3>
                        <div id="click-performance" class="chart-placeholder">
                            <i class="fas fa-chart-bar"></i>
                            <p>Loading performance...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users" class="tab-content">
                <div class="tab-header">
                    <h2>User Management</h2>
                    <div class="user-actions">
                        <button class="btn btn-secondary" id="sync-mailchimp-btn">
                            <i class="fas fa-sync"></i> Sync with Mailchimp
                        </button>
                        <div class="search-box">
                            <input type="text" id="user-search" placeholder="Search users...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                </div>

                <!-- User Comparison Section -->
                <div class="user-comparison-section">
                    <div class="comparison-cards">
                        <div class="comparison-card">
                            <div class="card-header">
                                <i class="fas fa-database"></i>
                                <h3>Our Database</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="db-user-count">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                        </div>
                        
                        <div class="comparison-card">
                            <div class="card-header">
                                <i class="fas fa-envelope"></i>
                                <h3>Mailchimp</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="mailchimp-user-count">0</div>
                                <div class="stat-label">Total Subscribers</div>
                            </div>
                        </div>
                        
                        <div class="comparison-card">
                            <div class="card-header">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3>Discrepancies</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="discrepancy-count">0</div>
                                <div class="stat-label">Missing/Extra</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sync-status" id="sync-status">
                        <i class="fas fa-info-circle"></i>
                        <span>Click "Sync with Mailchimp" to compare user lists</span>
                    </div>
                    
                    <style>
                        .stat-card.coming-soon {
                            opacity: 0.6;
                            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        }
                        
                        .stat-card.coming-soon h3 {
                            color: #6c757d;
                            font-style: italic;
                        }
                        
                        .sync-status {
                            margin-top: 15px;
                            padding: 12px;
                            border-radius: 6px;
                            background-color: #f8f9fa;
                            border: 1px solid #e9ecef;
                            color: #6c757d;
                            font-size: 14px;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        
                        .sync-status.syncing {
                            background-color: #fff3cd;
                            border-color: #ffeaa7;
                            color: #856404;
                        }
                        
                        .sync-status.success {
                            background-color: #d4edda;
                            border-color: #c3e6cb;
                            color: #155724;
                        }
                        
                        .sync-status.error {
                            background-color: #f8d7da;
                            border-color: #f5c6cb;
                            color: #721c24;
                        }
                        
                        .sync-status i {
                            font-size: 16px;
                        }
                    </style>
                </div>

                <div class="users-table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Name</th>
                                <th>Categories</th>
                                <th>Signup Date</th>
                                <th>Status</th>
                                <th>Mailchimp</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="settings-section">
                    <h3>Mailchimp Configuration</h3>
                    <div class="setting-item">
                        <label>API Key</label>
                        <input type="password" id="mailchimp-api-key" placeholder="Enter API key">
                    </div>
                    <div class="setting-item">
                        <label>Server Prefix</label>
                        <input type="text" id="mailchimp-server" placeholder="e.g., us13">
                    </div>
                    <div class="setting-item">
                        <label>List ID</label>
                        <input type="text" id="mailchimp-list-id" placeholder="Enter list ID">
                    </div>
                    <button class="btn btn-primary" id="save-mailchimp-btn">Save Mailchimp Settings</button>
                </div>

                <div class="settings-section">
                    <h3>Site Configuration</h3>
                    <div class="setting-item">
                        <label>Site Name</label>
                        <input type="text" id="site-name" value="Catered Savings">
                    </div>
                    <div class="setting-item">
                        <label>Contact Email</label>
                        <input type="email" id="contact-email" placeholder="admin@cateredsavings.com">
                    </div>
                    <button class="btn btn-primary" id="save-site-btn">Save Site Settings</button>
                </div>
            </div>

        </main>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Product</h3>
                <span class="close">&times;</span>
            </div>
            <form id="product-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-title">Product Title *</label>
                        <input type="text" id="product-title" required>
                    </div>
                    <div class="form-group">
                        <label for="product-retailer">Retailer *</label>
                        <input type="text" id="product-retailer" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-original-price">Original Price *</label>
                        <input type="number" id="product-original-price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-sale-price">Sale Price *</label>
                        <input type="number" id="product-sale-price" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-category">Category *</label>
                        <select id="product-category" required>
                            <option value="">Select category</option>
                            <option value="tech-electronics">Tech & Electronics</option>
                            <option value="fashion">Fashion</option>
                            <option value="home-garden">Home & Garden</option>
                            <option value="health-beauty">Health & Beauty</option>
                            <option value="sports-outdoors">Sports & Outdoors</option>
                            <option value="kids-family">Kids & Family</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="automotive">Automotive</option>
                            <option value="books-media">Books & Media</option>
                            <option value="pets">Pet Supplies</option>
                            <option value="office-education">Office & Education</option>
                            <option value="food-dining">Food & Dining</option>
                            <option value="travel">Travel</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-monthly-fee">Monthly Fee *</label>
                        <input type="number" id="product-monthly-fee" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="product-description">Description *</label>
                    <textarea id="product-description" rows="3" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-image">Image URL</label>
                        <input type="url" id="product-image" placeholder="https://example.com/image.jpg">
                    </div>
                    <div class="form-group">
                        <label for="product-url">Product URL *</label>
                        <input type="url" id="product-url" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-start-date">Start Date *</label>
                        <input type="date" id="product-start-date" required>
                    </div>
                    <div class="form-group">
                        <label for="product-end-date">End Date *</label>
                        <input type="date" id="product-end-date" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="product-active" checked>
                        <span class="checkmark"></span>
                        Active
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-product-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="save-product-btn">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">Add New User</h3>
                <span class="close" id="close-user-modal">&times;</span>
            </div>
            
            <form id="user-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="user-email">Email Address *</label>
                        <input type="email" id="user-email" required placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label for="user-name">Full Name</label>
                        <input type="text" id="user-name" placeholder="John Doe">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Categories *</label>
                    <div class="category-checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="tech-electronics">
                            <span class="checkmark"></span>
                            Tech & Electronics
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="fashion">
                            <span class="checkmark"></span>
                            Fashion & Style
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="home-garden">
                            <span class="checkmark"></span>
                            Home & Garden
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="health-beauty">
                            <span class="checkmark"></span>
                            Health & Beauty
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="sports-outdoors">
                            <span class="checkmark"></span>
                            Sports & Outdoors
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="kids-family">
                            <span class="checkmark"></span>
                            Kids & Family
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="entertainment">
                            <span class="checkmark"></span>
                            Entertainment
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="automotive">
                            <span class="checkmark"></span>
                            Automotive
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="books-media">
                            <span class="checkmark"></span>
                            Books & Media
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="pets">
                            <span class="checkmark"></span>
                            Pet Supplies
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="office-education">
                            <span class="checkmark"></span>
                            Office & Education
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="food-dining">
                            <span class="checkmark"></span>
                            Food & Dining
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="travel">
                            <span class="checkmark"></span>
                            Travel
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="categories" value="other">
                            <span class="checkmark"></span>
                            Other
                        </label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="user-status">Status</label>
                        <select id="user-status">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="unsubscribed">Unsubscribed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="add-to-mailchimp" checked>
                            <span class="checkmark"></span>
                            Add to Mailchimp
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-user-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="save-user-btn">Save User</button>
                </div>
            </form>
        </div>
    </div>

    <script src="admin.js?v=2025-09-11-4"></script>
    <script>
        // Ensure admin.js loads and dashboard updates
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (window.adminDashboard) {
                    console.log('Debug: adminDashboard found, loading data...');
                    window.adminDashboard.loadDashboardData();
                } else {
                    console.log('Debug: adminDashboard not found, setting fallback numbers...');
                    // Fallback: manually set numbers if admin.js fails to load
                    document.getElementById('total-users').textContent = '7';
                    document.getElementById('active-products').textContent = '8';
                }
                
                // Debug sync button
                const syncButton = document.getElementById('sync-mailchimp-btn');
                console.log('Debug: Sync button found:', !!syncButton);
                if (syncButton) {
                    syncButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Debug: Sync button clicked via fallback handler!');
                        alert('Sync button clicked! Check console for details.');
                    });
                }
            }, 1000);
        });
    </script>
    
    </div> <!-- End admin-container -->
</body>
</html>

